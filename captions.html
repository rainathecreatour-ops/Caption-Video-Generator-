<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Caption Video Generator</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: sans-serif; background: #111; color: #eee; display: flex; height: 100vh; overflow: hidden; }

  #left { flex: 1; display: flex; flex-direction: column; padding: 14px; gap: 10px; min-width: 0; }
  #right { width: 260px; background: #1a1a26; border-left: 1px solid #2a2a3a; padding: 12px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }

  h2 { color: #a78bfa; font-size: 1rem; flex-shrink: 0; }

  #uploadLabel { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 40px; border: 2px dashed #555; border-radius: 12px; background: #1a1a26; cursor: pointer; flex: 1; }
  #uploadLabel:hover { border-color: #a78bfa; }
  #fileIn { display: none; }

  #videoSection { flex: 1; display: none; flex-direction: column; gap: 8px; min-height: 0; }
  #videoSection.show { display: flex; }
  #videoWrap { flex: 1; position: relative; background: #000; border-radius: 10px; overflow: hidden; min-height: 0; }
  #vid { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; }

  #capDiv {
    position: absolute; left: 50%; transform: translateX(-50%);
    bottom: 40px; text-align: center; max-width: 90%;
    font-size: 28px; font-weight: bold; color: #fff;
    background: rgba(0,0,0,0.65); padding: 4px 16px; border-radius: 5px;
    display: none; pointer-events: none; white-space: normal;
  }

  #controls { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
  #playBtn { padding: 7px 16px; background: #7c3aed; color: #fff; border: none; border-radius: 7px; cursor: pointer; font-weight: bold; font-size: 1rem; }
  #seekBar { flex: 1; accent-color: #a78bfa; cursor: pointer; }
  #volBar { width: 70px; accent-color: #a78bfa; cursor: pointer; }
  #timeDisp { font-size: 0.75rem; color: #888; white-space: nowrap; }

  .btns { display: flex; gap: 8px; flex-shrink: 0; }
  .btn { padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 0.85rem; }
  .pri { background: #7c3aed; color: #fff; }
  .sec { background: #222; border: 1px solid #444; color: #ccc; }

  .rlabel { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 1px; color: #555; margin-bottom: 3px; }
  select, input[type=range] { width: 100%; background: #222; border: 1px solid #444; color: #eee; border-radius: 6px; padding: 5px 7px; font-size: 0.8rem; }
  input[type=color] { width: 100%; height: 30px; border: 1px solid #444; border-radius: 6px; background: #222; padding: 2px; cursor: pointer; }
  .two { display: flex; gap: 8px; }
  .two > div { flex: 1; }
  .badge { color: #a78bfa; font-size: 0.7rem; }
  hr { border: none; border-top: 1px solid #2a2a3a; }
  .pos-row { display: flex; gap: 5px; }
  .pos-btn { flex: 1; padding: 5px; border: 1px solid #444; background: #222; color: #888; border-radius: 6px; cursor: pointer; font-size: 0.73rem; }
  .pos-btn.on { border-color: #a78bfa; background: #2d1f5e; color: #a78bfa; }
  .add-cap { width: 100%; padding: 7px; border: 1px dashed #444; background: transparent; color: #666; border-radius: 6px; cursor: pointer; font-size: 0.78rem; }
  .add-cap:hover { border-color: #a78bfa; color: #a78bfa; }
  .cap-card { background: #111; border: 1px solid #2a2a3a; border-radius: 8px; padding: 7px; margin-bottom: 5px; }
  .cap-card.on { border-color: #60a5fa; }
  .cap-top { display: flex; align-items: center; gap: 3px; font-size: 0.68rem; color: #666; margin-bottom: 4px; }
  .cap-top input { width: 48px; background: #0a0a0a; border: 1px solid #333; color: #aaa; border-radius: 4px; padding: 2px; font-size: 0.68rem; }
  .cap-del { background: none; border: none; color: #555; cursor: pointer; margin-left: auto; }
  .cap-del:hover { color: #f87171; }
  .cap-ta { width: 100%; background: #0a0a0a; border: 1px solid #2a2a3a; color: #ddd; font-size: 0.8rem; border-radius: 5px; padding: 5px; resize: vertical; min-height: 36px; outline: none; font-family: inherit; }
  .cap-ta:focus { border-color: #a78bfa; }
  .empty { color: #444; font-size: 0.8rem; text-align: center; padding: 10px; }
</style>
</head>
<body>

<div id="left">
  <h2>üé¨ Caption Video Generator</h2>

  <label id="uploadLabel" for="fileIn">
    <div style="font-size:3rem">üìÅ</div>
    <div style="font-weight:600;font-size:1.1rem">Click to upload your video</div>
    <div style="color:#666;font-size:0.85rem">MP4 ¬∑ WebM ¬∑ MOV</div>
    <input type="file" id="fileIn" accept="video/*">
  </label>

  <div id="videoSection">
    <div id="videoWrap">
      <video id="vid" preload="auto"></video>
      <div id="capDiv"></div>
    </div>
    <div id="controls">
      <button id="playBtn">‚ñ∂</button>
      <input type="range" id="seekBar" min="0" value="0" step="0.05">
      <span style="font-size:0.75rem;color:#888">üîä</span>
      <input type="range" id="volBar" min="0" max="1" step="0.05" value="1">
      <span id="timeDisp">0:00 / 0:00</span>
    </div>
    <div class="btns">
      <button class="btn pri" onclick="addCaption()">+ Add Caption</button>
      <button class="btn sec" onclick="exportSRT()">‚¨á Export SRT</button>
    </div>
  </div>
</div>

<div id="right">
  <div class="rlabel">Caption Style</div>
  <div><div class="rlabel">Font</div>
    <select id="font" oninput="applyStyle()">
      <option>Arial</option><option>Georgia</option><option>Impact</option>
      <option>Verdana</option><option>Courier New</option><option>Times New Roman</option>
      <option>Trebuchet MS</option><option>Comic Sans MS</option>
    </select>
  </div>
  <div><div class="rlabel">Size <span class="badge" id="szLbl">28px</span></div>
    <input type="range" id="fsize" min="12" max="72" value="28" oninput="szLbl.textContent=this.value+'px';applyStyle()">
  </div>
  <div><div class="rlabel">Weight</div>
    <select id="fweight" oninput="applyStyle()">
      <option value="400">Regular</option><option value="600">Semi-Bold</option>
      <option value="700" selected>Bold</option><option value="900">Black</option>
    </select>
  </div>
  <div class="two">
    <div><div class="rlabel">Text Color</div><input type="color" id="fcolor" value="#ffffff" oninput="applyStyle()"></div>
    <div><div class="rlabel">BG Color</div><input type="color" id="bgcolor" value="#000000" oninput="applyStyle()"></div>
  </div>
  <div><div class="rlabel">Opacity <span class="badge" id="opLbl">60%</span></div>
    <input type="range" id="bgop" min="0" max="100" value="60" oninput="opLbl.textContent=this.value+'%';applyStyle()">
  </div>
  <div><div class="rlabel">Position</div>
    <div class="pos-row">
      <button class="pos-btn" onclick="setPos('top',this)">Top</button>
      <button class="pos-btn" onclick="setPos('center',this)">Mid</button>
      <button class="pos-btn on" onclick="setPos('bottom',this)">Bottom</button>
    </div>
  </div>
  <hr>
  <button class="add-cap" onclick="addCaption()">+ Add Caption at Current Time</button>
  <div id="capList"><div class="empty">No captions yet.</div></div>
</div>

<script>
  const fileIn  = document.getElementById('fileIn');
  const vid     = document.getElementById('vid');
  const capDiv  = document.getElementById('capDiv');
  const playBtn = document.getElementById('playBtn');
  const seekBar = document.getElementById('seekBar');
  const volBar  = document.getElementById('volBar');
  const timeDisp = document.getElementById('timeDisp');
  const videoSection  = document.getElementById('videoSection');
  const uploadLabel   = document.getElementById('uploadLabel');

  let captions = [], nextId = 1, capPos = 'bottom';

  fileIn.addEventListener('change', function () {
    const file = this.files[0];
    if (!file) return;
    vid.src = URL.createObjectURL(file);
    vid.load();
    vid.addEventListener('canplay', () => {
      seekBar.max = vid.duration || 100;
      uploadLabel.style.display = 'none';
      videoSection.classList.add('show');
      applyStyle();
    }, { once: true });
  });

  playBtn.addEventListener('click', () => {
    if (vid.paused) { vid.play(); playBtn.textContent = '‚è∏'; }
    else            { vid.pause(); playBtn.textContent = '‚ñ∂'; }
  });
  vid.addEventListener('ended', () => { playBtn.textContent = '‚ñ∂'; });

  vid.addEventListener('timeupdate', () => {
    seekBar.value = vid.currentTime;
    timeDisp.textContent = fmt(vid.currentTime) + ' / ' + fmt(vid.duration || 0);
    const cap = captions.find(c => vid.currentTime >= c.start && vid.currentTime <= c.end);
    capDiv.textContent = cap ? cap.text : '';
    capDiv.style.display = cap ? 'block' : 'none';
    document.querySelectorAll('.cap-card').forEach(el =>
      el.classList.toggle('on', cap && +el.dataset.id === cap.id));
  });

  seekBar.addEventListener('input', () => { vid.currentTime = +seekBar.value; });
  volBar.addEventListener('input',  () => { vid.volume = +volBar.value; });

  function fmt(s) {
    if (!s || isNaN(s)) return '0:00';
    return Math.floor(s / 60) + ':' + String(Math.floor(s % 60)).padStart(2, '0');
  }

  function applyStyle() {
    capDiv.style.fontFamily  = document.getElementById('font').value;
    capDiv.style.fontSize    = document.getElementById('fsize').value + 'px';
    capDiv.style.fontWeight  = document.getElementById('fweight').value;
    capDiv.style.color       = document.getElementById('fcolor').value;
    const hex = document.getElementById('bgcolor').value;
    const op  = document.getElementById('bgop').value / 100;
    const r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16);
    capDiv.style.backgroundColor = `rgba(${r},${g},${b},${op})`;
    setPosSilent(capPos);
  }

  function setPos(p, btn) {
    capPos = p;
    document.querySelectorAll('.pos-btn').forEach(b => b.classList.remove('on'));
    btn.classList.add('on');
    setPosSilent(p);
  }

  function setPosSilent(p) {
    if (p === 'top')     { capDiv.style.bottom = 'auto'; capDiv.style.top = '12px';  capDiv.style.transform = 'translateX(-50%)'; }
    else if (p==='center'){ capDiv.style.top = '50%';   capDiv.style.bottom = 'auto'; capDiv.style.transform = 'translate(-50%,-50%)'; }
    else                 { capDiv.style.top = 'auto';   capDiv.style.bottom = '40px'; capDiv.style.transform = 'translateX(-50%)'; }
  }

  function addCaption() {
    const t = parseFloat((vid.currentTime || 0).toFixed(1));
    captions.push({ id: nextId++, start: t, end: parseFloat((t + 3).toFixed(1)), text: 'New caption' });
    captions.sort((a, b) => a.start - b.start);
    renderList();
  }

  function deleteCaption(id) { captions = captions.filter(c => c.id !== id); renderList(); }

  function renderList() {
    const list = document.getElementById('capList');
    if (!captions.length) { list.innerHTML = '<div class="empty">No captions yet.</div>'; return; }
    list.innerHTML = '';
    captions.forEach(cap => {
      const d = document.createElement('div');
      d.className = 'cap-card'; d.dataset.id = cap.id;
      d.innerHTML = `
        <div class="cap-top">
          <input type="number" step="0.1" min="0" value="${cap.start}">
          <span>‚Üí</span>
          <input type="number" step="0.1" min="0" value="${cap.end}">s
          <button style="background:none;border:none;color:#666;cursor:pointer;font-size:0.7rem" onclick="vid.currentTime=${cap.start}">‚ñ∂</button>
          <button class="cap-del" onclick="deleteCaption(${cap.id})">‚úï</button>
        </div>
        <textarea class="cap-ta">${cap.text}</textarea>`;
      const [s, e] = d.querySelectorAll('input[type=number]');
      const ta = d.querySelector('textarea');
      s.onchange = () => cap.start = +s.value;
      e.onchange = () => cap.end   = +e.value;
      ta.oninput = () => cap.text  = ta.value;
      list.appendChild(d);
    });
  }

  function exportSRT() {
    if (!captions.length) { alert('No captions to export.'); return; }
    let srt = '';
    const f = s => [Math.floor(s/3600),Math.floor((s%3600)/60),Math.floor(s%60)].map(n=>String(n).padStart(2,'0')).join(':') + ',' + String(Math.round((s%1)*1000)).padStart(3,'0');
    captions.forEach((c, i) => srt += `${i+1}\n${f(c.start)} --> ${f(c.end)}\n${c.text}\n\n`);
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([srt], { type: 'text/plain' }));
    a.download = 'captions.srt'; a.click();
  }

  applyStyle();
</script>
</body>
</html>
